'use strict';function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var EVENTS={join:'join',leave:'leave',message:'message'},STALE_CONNECTION_THRESHOLD_SECONDS=100,SOCKET_POLLING_RATE=1e4,now=function(){return new Date().getTime()},secondsSince=function(a){return(now()-a)/1e3},Amber={Channel:function(){function a(b,c){_classCallCheck(this,a),this.topic=b,this.socket=c,this.onMessageHandlers=[]}return a.prototype.join=function join(){this.socket.ws.send(JSON.stringify({event:EVENTS.join,topic:this.topic}))},a.prototype.leave=function leave(){this.socket.ws.send(JSON.stringify({event:EVENTS.leave,topic:this.topic}))},a.prototype.handleMessage=function handleMessage(b){this.onMessageHandlers.forEach(function(c){c.subject===b.subject&&c.callback(b.payload)})},a.prototype.on=function on(b,c){this.onMessageHandlers.push({subject:b,callback:c})},a.prototype.push=function push(b,c){this.socket.ws.send(JSON.stringify({event:EVENTS.message,topic:this.topic,subject:b,payload:c}))},a}(),Socket:function(){function a(b){_classCallCheck(this,a),this.endpoint=b,this.ws=null,this.channels=[],this.lastPing=now(),this.reconnectTries=0,this.attemptReconnect=!0}return a.prototype._connectionIsStale=function _connectionIsStale(){return secondsSince(this.lastPing)>STALE_CONNECTION_THRESHOLD_SECONDS},a.prototype._reconnect=function _reconnect(){var b=this;clearTimeout(this.reconnectTimeout),this.reconnectTimeout=setTimeout(function(){b.reconnectTries++,b.connect(b.params),b._reconnect()},this._reconnectInterval())},a.prototype._reconnectInterval=function _reconnectInterval(){return[1000,2000,5000,10000][this.reconnectTries]||1e4},a.prototype._poll=function _poll(){var b=this;this.pollingTimeout=setTimeout(function(){b._connectionIsStale()?b._reconnect():b._poll()},SOCKET_POLLING_RATE)},a.prototype._startPolling=function _startPolling(){clearTimeout(this.pollingTimeout),this._poll()},a.prototype._handlePing=function _handlePing(){this.lastPing=now()},a.prototype._reset=function _reset(){clearTimeout(this.reconnectTimeout),this.reconnectTries=0,this.attemptReconnect=!0,this._startPolling()},a.prototype.connect=function connect(b){var d=this;this.params=b;var c={location:window.location.hostname,port:window.location.port,protocol:'https:'===window.location.protocol?'wss:':'ws:'};return b&&Object.assign(c,b),c.port&&(c.location+=':'+c.port),new Promise(function(e){d.ws=new WebSocket(c.protocol+'//'+c.location+d.endpoint),d.ws.onmessage=function(g){d.handleMessage(g)},d.ws.onclose=function(){d.attemptReconnect&&d._reconnect()},d.ws.onopen=function(){d._reset(),e()}})},a.prototype.disconnect=function disconnect(){this.attemptReconnect=!1,clearTimeout(this.pollingTimeout),clearTimeout(this.reconnectTimeout),this.ws.close()},a.prototype.channel=function channel(b){var c=new Channel(b,this);return this.channels.push(c),c},a.prototype.handleMessage=function handleMessage(b){if('ping'===b.data)return this._handlePing();var c=JSON.parse(b.data);this.channels.forEach(function(d){d.topic===c.topic&&d.handleMessage(c)})},a}()};document.addEventListener('DOMContentLoaded',function(){watchAnchorButtons()});function watchAnchorButtons(){document.querySelectorAll('a[data-method]').forEach(function(a){var b=a.getAttribute('data-method');a.addEventListener('click',function(c){c.preventDefault();var d=a.getAttribute('data-confirm')||'Are you sure?';if(confirm(d)){var e=document.createElement('form'),f=document.createElement('input');e.setAttribute('action',a.getAttribute('href')),e.setAttribute('method','POST'),f.setAttribute('type','hidden'),f.setAttribute('name','_method'),f.setAttribute('value',b),e.appendChild(f),document.body.appendChild(e),e.submit()}})})}'WebSocket'in window&&function(){var a=function(){for(var e=[].slice.call(document.getElementsByTagName('link')),f=document.getElementsByTagName('head')[0],g=0;g<e.length;++g){var h=e[g],j=h.rel;if(h.href&&'string'!=typeof j||0==j.length||'stylesheet'==j.toLowerCase()){f.removeChild(h);var k=h.href.replace(/(&|\\?)_cacheOverride=\\d+/,'');h.href=k+(0<=k.indexOf('?')?'&':'?')+'_cacheOverride='+new Date().valueOf(),f.appendChild(h)}}},b='http:'===window.location.protocol?'ws://':'wss://',c=''+b+window.location.host+'/client-reload',d=new WebSocket(c);d.onmessage=function(e){'reload'==e.data?window.location.reload():'refreshcss'==e.data&&a()},d.onclose=function(){tryReload()}}();function tryReload(){var a=new XMLHttpRequest;a.open('GET',window.location.href,!0),a.onreadystatechange=function(){4==a.readyState&&(0==a.status?setTimeout(function(){tryReload()},1e3):window.location.reload())},a.send()}Object.assign(Date.prototype,{toGranite:function toGranite(){var a=function(b){return 10>b?'0'+b:b};return this.getUTCFullYear()+'-'+a(this.getUTCMonth()+1)+'-'+a(this.getUTCDate())+' '+a(this.getUTCHours())+':'+a(this.getUTCMinutes())+':'+a(this.getUTCSeconds())}});